services:
  db:
    image: postgres:16
    environment:
      POSTGRES_USER: booking
      POSTGRES_PASSWORD: booking
      POSTGRES_DB: booking
    ports: ["5432:5432"]
    volumes:
      - db_data:/var/lib/postgresql/data


  redis:
    image: redis:7
    ports: ["6379:6379"]


  meilisearch:
    image: getmeili/meilisearch:latest
    environment:
      MEILI_NO_ANALYTICS: "true"
      MEILI_MASTER_KEY: "dev_master_key"
    ports: ["7700:7700"]


  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    environment:
      PORT: 4000
      NODE_ENV: development
    ports: ["4000:4000"]
    depends_on: [db, redis]


  web:
    build:
      context: ./apps/web
      dockerfile: Dockerfile
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:4000
    ports: ["3000:3000"]
    depends_on: [api]
volumes:
  db_data: {}